<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Share Experience - KMS</title>

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Sarabun', sans-serif; background-color: #e8eef5; min-height: 100vh; overflow-x: hidden; }
    .container { display: flex; min-height: 100vh; }

    /* ===== Sidebar (Desktop) ===== */
    .sidebar {
      width: 70px;
      background: linear-gradient(180deg, #5b9bd5 0%, #4a89c8 100%);
      display: flex; flex-direction: column; align-items: center;
      padding-top: 20px; gap: 10px;
      position: fixed; left: 0; top: 0;
      height: 100vh; z-index: 10;
    }
    .sidebar-icon {
      width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.7); font-size: 20px;
      border-radius: 12px; cursor: pointer;
      transition: all 0.3s ease; text-decoration: none;
    }
    .sidebar-icon:hover, .sidebar-icon.active { background-color: rgba(255,255,255,0.2); color: #fff; }

    /* ===== Main ===== */
    .main-content { flex: 1; margin-left: 70px; width: calc(100% - 70px); }

    .header {
      background: linear-gradient(135deg, #5b9bd5 0%, #2e75b6 100%);
      padding: 34px 40px;
      text-align: center;
    }
    .header h1 { color: #fff; font-size: 30px; font-weight: 700; margin-bottom: 8px; }
    .header p { color: rgba(255,255,255,0.92); font-size: 15px; line-height: 1.6; }

    .wrap { padding: 22px 40px 40px; }

    .form-card {
      max-width: 980px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      overflow: hidden;
    }

    .form-top {
      padding: 18px 20px;
      border-bottom: 1px solid #eef2f6;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 12px;
      background: #eef5ff;
      color: #2e75b6;
      font-weight: 600;
    }

    form { padding: 20px; }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px 16px;
    }

    .field { display: flex; flex-direction: column; gap: 6px; }
    label { font-size: 14px; font-weight: 700; color: #2c3e50; }

    input[type="text"], select, textarea {
      width: 100%;
      padding: 11px 12px;
      border: 2px solid #e6e6e6;
      border-radius: 10px;
      font-size: 14px;
      outline: none;
      transition: 0.2s ease;
      background: #fff;
    }
    textarea { min-height: 110px; resize: vertical; }
    input:focus, select:focus, textarea:focus { border-color: #5b9bd5; }

    .hint { font-size: 12px; color: #7f8c8d; line-height: 1.4; }

    /* ===== Image Upload ===== */
    .uploader {
      border: 2px dashed #cfe1f4;
      border-radius: 14px;
      padding: 14px;
      background: #f7fbff;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .uploader-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 10px;
      padding: 11px 14px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: 0.2s ease;
      text-decoration: none;
      justify-content: center;
    }
    .btn-primary { background: #5b9bd5; color: #fff; }
    .btn-primary:hover { background: #4a89c8; }
    .btn-ghost { background: #eef5ff; color: #2e75b6; }
    .btn-ghost:hover { background: #e3efff; }
    .btn-danger { background: #ffe8ea; color: #b3261e; }
    .btn-danger:hover { background: #ffd7db; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }

    .thumbs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .thumb {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #eaeaea;
      position: relative;
      aspect-ratio: 4 / 3;
    }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .thumb button {
      position: absolute;
      top: 6px; right: 6px;
      width: 30px; height: 30px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: rgba(0,0,0,0.55);
      color: #fff;
    }

    /* ===== Footer actions ===== */
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 18px;
      flex-wrap: wrap;
    }

    .status {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 12px;
      display: none;
      font-size: 14px;
      line-height: 1.5;
    }
    .status.show { display: block; }
    .status.info { background: #eef5ff; color: #1f4f7a; border: 1px solid #cfe1f4; }
    .status.ok { background: #e8f5e9; color: #1b5e20; border: 1px solid #c8e6c9; }
    .status.err { background: #ffebee; color: #b71c1c; border: 1px solid #ffcdd2; }

    /* ===== Responsive ===== */
    @media (max-width: 980px) {
      .wrap { padding: 18px 24px 30px; }
      .header { padding: 26px 20px; }
      .header h1 { font-size: 26px; }
    }

    @media (max-width: 900px) {
      .container { flex-direction: column; }

      .sidebar {
        width: 100%;
        height: 60px;
        flex-direction: row;
        justify-content: center;
        padding: 10px;
        position: sticky;
        top: 0;
      }

      .main-content { margin-left: 0; width: 100%; }
    }

    @media (max-width: 768px) {
      .wrap { padding: 16px; }
      form { padding: 16px; }
      .grid { grid-template-columns: 1fr; }
      .thumbs { grid-template-columns: repeat(2, 1fr); }
      .actions .btn { width: 100%; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <nav class="sidebar">
      <a href="index.html" class="sidebar-icon" title="Home"><i class="fas fa-home"></i></a>
      <a href="knowledge-base.html" class="sidebar-icon" title="Knowledge Base"><i class="fas fa-book-open"></i></a>
      <a href="learning-path.html" class="sidebar-icon" title="Learning Path"><i class="fas fa-graduation-cap"></i></a>
      <a href="quiz.html" class="sidebar-icon" title="Quiz"><i class="fas fa-clipboard-check"></i></a>
      <a href="share-experience.html" class="sidebar-icon active" title="Share Experience"><i class="fas fa-comments"></i></a>
    </nav>

    <main class="main-content">
      <header class="header">
        <h1>Share Experience</h1>
        <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° (‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏£‡∏π‡∏õ)</p>
      </header>

      <div class="wrap">
        <section class="form-card">
          <div class="form-top">
            <div class="badge"><i class="fa-solid fa-file-pen"></i> ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
            <div class="hint">* ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet (‡∏à‡∏∞‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)</div>
          </div>

          <form id="shareForm">
            <div class="grid">
              <!-- 1) ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤ -->
              <div class="field" style="grid-column: 1 / -1;">
                <label for="problemTitle">1) ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label>
                <input id="problemTitle" type="text" required placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤" />
              </div>

              <!-- 2) ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Å‡∏£‡∏≠‡∏Å -->
              <div class="field">
                <label for="reporterName">2) ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Å‡∏£‡∏≠‡∏Å</label>
                <input id="reporterName" type="text" required placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
              </div>

              <!-- 3) ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå -->
              <div class="field">
                <label for="product">3) ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</label>
                <select id="product" required>
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå --</option>
                  <option value="‡∏¢‡∏≤‡∏≠‡∏°‡∏°‡∏∞‡πÅ‡∏ß‡πâ‡∏á ‡∏£‡∏™‡∏ö‡πä‡∏ß‡∏¢">‡∏¢‡∏≤‡∏≠‡∏°‡∏°‡∏∞‡πÅ‡∏ß‡πâ‡∏á ‡∏£‡∏™‡∏ö‡πä‡∏ß‡∏¢</option>
                </select>
              </div>

              <!-- 4) Process -->
              <div class="field">
                <label for="process">4) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Process</label>
                <select id="process" required>
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ --</option>
                  <option value="1">1. ‡∏ú‡∏™‡∏°‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å</option>
                  <option value="2">2. ‡πÅ‡∏£‡πà‡∏á‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å</option>
                  <option value="3">3. ‡∏≠‡∏ö‡∏•‡∏°‡∏£‡πâ‡∏≠‡∏ô</option>
                  <option value="4">4. ‡πÅ‡∏£‡πà‡∏á‡πÅ‡∏´‡πâ‡∏á</option>
                  <option value="5">5. ‡∏ú‡∏™‡∏°‡πÅ‡∏´‡πâ‡∏á</option>
                  <option value="6">6. ‡∏ï‡∏≠‡∏Å‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤</option>
                  <option value="7">7. ‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏ã‡∏≠‡∏á</option>
                </select>
              </div>

              <!-- 5) ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
              <div class="field">
                <label for="docType">5) ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
                <select id="docType" required>
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ --</option>
                  <option value="OPL">OPL</option>
                  <option value="WI">WI</option>
                  <option value="Experience">Share Experience</option>
                </select>
              </div>

              <!-- 6) ‡∏£‡∏π‡∏õ -->
              <div class="field" style="grid-column: 1 / -1;">
                <label>6) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 1‚Äì4 ‡∏£‡∏π‡∏õ)</label>
                <div class="uploader">
                  <div class="uploader-row">
                    <div class="hint" id="imgHint">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                      <button type="button" class="btn btn-ghost" id="btnPick">
                        <i class="fa-regular fa-image"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ
                      </button>
                      <button type="button" class="btn btn-danger" id="btnClearImages">
                        <i class="fa-solid fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ
                      </button>
                    </div>
                  </div>

                  <input id="images" type="file" accept="image/*" multiple hidden />
                  <div class="thumbs" id="thumbs"></div>
                </div>
              </div>

              <!-- 7) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
              <div class="field" style="grid-column: 1 / -1;">
                <label for="problemDetail">7) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label>
                <textarea id="problemDetail" required placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤"></textarea>
              </div>

              <!-- 8) ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
              <div class="field" style="grid-column: 1 / -1;">
                <label for="solution">8) ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</label>
                <textarea id="solution" required placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"></textarea>
              </div>
            </div>

            <div class="actions">
              <button class="btn btn-primary" type="submit" id="btnSubmit">
                <i class="fa-solid fa-floppy-disk"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </button>
              <button class="btn btn-ghost" type="button" id="btnReset">
                <i class="fa-solid fa-rotate-right"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
              </button>
            </div>

            <div class="status" id="statusBox"></div>
          </form>
        </section>
      </div>
    </main>
  </div>

<script>
  // üî¥ ‡πÉ‡∏™‡πà URL Web App ‡∏Ç‡∏≠‡∏á Apps Script (‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec)
  const SCRIPT_URL = "PUT_YOUR_WEBAPP_URL_HERE";

  const form = document.getElementById('shareForm');
  const imagesInput = document.getElementById('images');
  const btnPick = document.getElementById('btnPick');
  const btnClearImages = document.getElementById('btnClearImages');
  const thumbs = document.getElementById('thumbs');
  const imgHint = document.getElementById('imgHint');
  const btnReset = document.getElementById('btnReset');
  const btnSubmit = document.getElementById('btnSubmit');
  const statusBox = document.getElementById('statusBox');

  let selectedFiles = [];

  function setStatus(type, msg) {
    statusBox.className = 'status show ' + type;
    statusBox.innerHTML = msg;
  }
  function clearStatus() {
    statusBox.className = 'status';
    statusBox.innerHTML = '';
  }

  function renderThumbs() {
    thumbs.innerHTML = '';
    if (selectedFiles.length === 0) {
      imgHint.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ';
      return;
    }
    imgHint.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${selectedFiles.length} ‡∏£‡∏π‡∏õ`;

    selectedFiles.forEach((file, idx) => {
      const url = URL.createObjectURL(file);
      const div = document.createElement('div');
      div.className = 'thumb';
      div.innerHTML = `
        <img src="${url}" alt="img-${idx+1}">
        <button type="button" title="‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ"><i class="fa-solid fa-xmark"></i></button>
      `;
      div.querySelector('button').addEventListener('click', () => {
        selectedFiles.splice(idx, 1);
        renderThumbs();
      });
      thumbs.appendChild(div);
    });
  }

  btnPick.addEventListener('click', () => imagesInput.click());

  imagesInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files || []);
    if (files.length === 0) return;

    const merged = selectedFiles.concat(files);
    if (merged.length > 4) {
      selectedFiles = merged.slice(0, 4);
      setStatus('err', '‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
    } else {
      selectedFiles = merged;
      clearStatus();
    }

    imagesInput.value = '';
    renderThumbs();
  });

  btnClearImages.addEventListener('click', () => {
    selectedFiles = [];
    imagesInput.value = '';
    renderThumbs();
    clearStatus();
  });

  btnReset.addEventListener('click', () => {
    form.reset();
    selectedFiles = [];
    imagesInput.value = '';
    renderThumbs();
    clearStatus();
  });

  // === file -> base64 (‡∏ï‡∏±‡∏î prefix "data:image/...;base64,") ===
  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        const res = String(reader.result || "");
        const base64 = res.includes(",") ? res.split(",")[1] : res;
        resolve(base64);
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearStatus();

    if (!SCRIPT_URL || SCRIPT_URL.includes("PUT_YOUR_WEBAPP_URL_HERE")) {
      setStatus('err', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà SCRIPT_URL (Web App URL) ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
      return;
    }

    if (selectedFiles.length < 1) {
      setStatus('err', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏£‡∏π‡∏õ)');
      return;
    }

    btnSubmit.disabled = true;
    setStatus('info', '<i class="fa-solid fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ + ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ...');

    try {
      // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô base64
      const images = [];
      for (const f of selectedFiles) {
        const base64 = await fileToBase64(f);
        images.push({
          name: f.name,
          type: f.type,
          base64: base64
        });
      }

      // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°
      const payload = {
        problemTitle: document.getElementById('problemTitle').value.trim(),
        reporterName: document.getElementById('reporterName').value.trim(),
        product: document.getElementById('product').value,
        process: document.getElementById('process').value,
        docType: document.getElementById('docType').value,
        problemDetail: document.getElementById('problemDetail').value.trim(),
        solution: document.getElementById('solution').value.trim(),
        images: images
        // result: "..."   // ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ
      };

      const resp = await fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const json = await resp.json();

      if (!json || json.status !== "success") {
        throw new Error((json && json.message) ? json.message : "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }

      setStatus('ok',
        `<i class="fa-solid fa-circle-check"></i> ${json.message}<br>
         ‚úÖ PDF: <a href="${json.pdfUrl}" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF</a><br>
         ‚úÖ Doc: <a href="${json.docUrl}" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå Doc</a>`
      );

      form.reset();
      selectedFiles = [];
      renderThumbs();

    } catch (err) {
      console.error(err);
      setStatus('err', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + String(err.message || err));
    } finally {
      btnSubmit.disabled = false;
    }
  });

  renderThumbs();
</script>


  btnPick.addEventListener('click', () => imagesInput.click());

  imagesInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files || []);
    if (files.length === 0) return;

    const merged = selectedFiles.concat(files);
    if (merged.length > 4) {
      selectedFiles = merged.slice(0, 4);
      setStatus('err', '‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
    } else {
      selectedFiles = merged;
      clearStatus();
    }

    imagesInput.value = ''; // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
    renderThumbs();
  });

  btnClearImages.addEventListener('click', () => {
    selectedFiles = [];
    imagesInput.value = '';
    renderThumbs();
    clearStatus();
  });

  btnReset.addEventListener('click', () => {
    form.reset();
    selectedFiles = [];
    imagesInput.value = '';
    renderThumbs();
    clearStatus();
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    clearStatus();

    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏π‡∏õ 1-4 ‡∏£‡∏π‡∏õ
    if (selectedFiles.length < 1) {
      setStatus('err', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡∏£‡∏π‡∏õ)');
      return;
    }

    btnSubmit.disabled = true;
    setStatus('info', '<i class="fa-solid fa-spinner fa-spin"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) ‚Äî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏à‡∏∞‡∏ï‡πà‡∏≠ Google Sheet');

    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏£‡∏ö)
    const data = {
      ProblemTitle: document.getElementById('problemTitle').value.trim(),
      ReporterName: document.getElementById('reporterName').value.trim(),
      Product: document.getElementById('product').value,
      Process: document.getElementById('process').value,
      DocumentType: document.getElementById('docType').value,
      ProblemDetail: document.getElementById('problemDetail').value.trim(),
      Solution: document.getElementById('solution').value.trim(),
      ImagesCount: selectedFiles.length
    };

    console.log('FORM DATA:', data);

    setTimeout(() => {
      btnSubmit.disabled = false;
      setStatus('ok', '<i class="fa-solid fa-circle-check"></i> ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚úÖ ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet + ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ + ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF');
      form.reset();
      selectedFiles = [];
      renderThumbs();
    }, 600);
  });

  renderThumbs();
</script>

</body>
</html>

